<!DOCTYPE html>
<html>
<head>
    <title>Live GPS Location</title>
    <style>
        #map {
            height: 90vh;
            width: 100%;
        }
    </style>
</head>
<body>
<h2>Live GPS Location on Google Map</h2>
<div id="map"></div>

<script>
let map, marker, directionsService, directionsRenderer;

function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
        zoom: 16,
        center: { lat: 27.7172, lng: 85.3240 }, // Default Kathmandu
        mapTypeId: google.maps.MapTypeId.HYBRID 
    });

    marker = new google.maps.Marker({
        map: map,
        title: "Your Location"
    });

    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({ suppressMarkers: true,polylineOptions: { strokeWeight: 5 }});
    directionsRenderer.setMap(map);

    trackLocation();
    setInterval(trackLocation, 1000); // update every 5 seconds
}

function trackLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            const pos = { lat: lat, lng: lng };
            map.setCenter(pos);
            marker.setPosition(pos);

            // Example Destination (Change this)
            const destination = { lat: 27.6939, lng: 85.2815 };

            directionsService.route({
                origin: pos,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING
            }, (result, status) => {
                if (status === "OK") {
                    directionsRenderer.setDirections(result);

                    const leg = result.routes[0].legs[0];
                    console.log("Distance:", leg.distance.text);
                    console.log("ETA:", leg.duration.text);
                } else {
                    console.error("Route error:", status);
                }
            });

        }, err => {
            alert("GPS Permission Denied!");
        }, {
            enableHighAccuracy: true
        });
    } else {
        alert("Geolocation not supported!");
    }
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmpzR958RTBkou1KarjmMA_NLbuK6_vfE&callback=initMap" async defer></script>

</body>
</html>
